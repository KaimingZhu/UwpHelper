## CCFX文档·CommandLine版本

#### Part 1. 大纲
 - CCfx是Gemx的后端，可以理解成是GUI调用了其进行服务
 - 获取执行模式列表的命令行输入
    - `ccfx -h`
 - 获取每个执行模式的帮助信息的命令行输入
    - ` ccfx d -h `
    - ` ccfx m -h `

#### Part 2. 检测与打印代码克隆状况
以下以**检测给定目录下的Java文件的克隆情况**为例 **(.ccfxd)**：

` ccfx d java -dn c：\ target \ src `
- `ccfx` : 执行的程序(ccfx)
- `d` : 执行模式d——用于**检测**
- `java` : 监测的语言种类——本次使用`csharp`即可，可以检测.cs文件
- `dn` : 指定存储的目录，通常情况下会存储到相同的目录下(PS : 可以选择 `-o file` 指令指定需要存储的文件名，通常情况下存储为**a.ccfxd**)
- `c:\target\src` : 目标目录，该目录下的.java文件(本例)会作为此次的检测目标

对应的输出文件是一个二进制文件，如果需要对其作为文本打印，需要用执行模式 `p` ，格式如下：

`ccfx p a.ccfxd`

(PS : 若需要将结果保存为txt，可以在后面追加`> url`，在本例，即为：`ccfx p a.ccfxd > D:\a.txt`)

#### Part 3. 克隆的度量标准与过滤问题(选择需要的文件的结果进行保存)

**Question : 问题来了，什么是指标？？**

CCFX具有计算代码克隆和源文件的指标的功能，用户可以使用这些指标来进行**对代码克隆或源文件的某些过滤**。

(下例中，仍与` ccfx d java -dn c：\ target \ src `相同，对其进行进一步阐述)

1. 指标的计算 **(.tsv文件)**
    - 计算指标，需要使用**执行模式m**。有两类指标：克隆指标和文件指标。
    - 下面的命令行是获得克隆度量标准的计算值(-c)：
        - `ccfx m a.ccfxd -c`
    - 下面的命令行是获得文件度量标准的计算值(-f)：
        - `ccfx m a.ccfxd -f`
    - 输出文件使用选项`-o file`进行指定。我们可以为每个选项-c或-f指定选项-o。因此，下面的命令行意味着提取克隆指标和文件指标：
        - `ccfx m a.ccfxd -c -o clonemetrics.tsv -f -o filemetrics.tsv`

2. 按指标值进行过滤

   按指标值进行过滤，分为两步：
    - 第一步：制作一个符合过滤条件的文件ID列表 **(生成.txt文件)**
    - 第二步：按照写出的文件ID列表对其他文件进行**删除**操作 **(按第一步的.txt文件进行文件操作)**
    
    以下对两步进行样例示范：
    1. Step1 : 制作过滤条件列表(假设计算出的度量指标已保存为 **filemetrics.tsv**)
        - 如**文件的代码片段包含源代码的片段**，使用**CVR > 0**作为表达式
            - `picosel from filemetrics.tsv select FID where CVR .gt. 0.0 > remainingfiles.txt`
            - `FID`：.tsv文件中，会把各文件的FID放在第一行
            - `CVR` : 这个比较标准的本质是**对应的疑似克隆代码包含模板的部分的比率**
            - `where` : 限定过滤条件
        - 选择**包含重复代码**的源文件（表达式为`RNR .lt. 0.1`）并且**和其他文件之间具有大量代码克隆**的源文件（表达式为`RSA .gt. 0.9`）
            - `picosel from filemetrics.tsv select FID where RNR .lt. 0.1 and RSA .gt. 0.9 > remainingfiles.txt`
            - `and` : 条件并列
        - *Tips1 : 比较条件列*
            - `.eq.` :	= (相等)
            - `.ge.` : >= (大于等于)
            - `.gt.` : > (大于)
            - `.le.` : <= (小于等于)
            - `.lt.` : < (小于)
        - *Tips2*：该实例用于保存对应的文件，如果需要保存对应的代码，将FID改成CID即可
    2. Step2 : 使用**执行模式s**对对应的文件进行过滤
        - 以下指令用于对源结果按FID进行过滤，并将新结果保存到filtered.ccfxd
            - `ccfxd s a.ccfxd -o filtered.ccfxd -fi remainfiles.txt`
            - `a.ccfxd` 为源文件，`filtered.ccfxd`为过滤结果文件
            - `-fi` 指令为指定需要保留的文件的FID，后面所接的 `remainfiles.txt`指向已经标出需要保存的FID文件的.txt文件
        - 若需要按克隆指标进行过滤，请使用`-ci`指令,以以下操作为例：**对输入的克隆检测情况分析文件a.ccfxd，进行关于代码克隆情况的过滤，并将结果保存到克隆数据文件filtered.ccfxd**
            - 进行指标计算
                - `ccfx m a.ccfxd -c -o clonemetrics.tsv`
            - 进行对某一指标的过滤(以CONDITION代替)
                - `picosel -o remainclones.txt from clonemetrics.tsv select CID where "CONDITION"`
            - 按照过滤出的文件名进行对冗余文件的删除
                - `ccfx s a.ccfxd -o filtered.ccfxd -ci remainclones.txt`

#### Part 4. 文件列表
文件列表的作用是：指定一列用于比对代码克隆的文件，将其用于代码匹配（即**克隆检测**）。其作用方式为：以明确的方式逐个指定克隆文件的路径，在以下情况下，它会发挥很棒的效果
- 指定文件夹中某些文件不必用于克隆(如某些后缀名无法进行分析的文件)
- 指定某些文件同样需要克隆比对（如C++中的.ini文件）
- 修改生成的分析数据中的文件顺序

下面介绍**生成文件列表**的方法（同样以上面的java分析为例，目标目录是`c:\target\src`）:
1. 要在目标目录中**找到Java源文件**并**将文件列表另存为文件filelist.txt**，请键入以下命令行：
    - `ccfx f java -a -l n c：\ target \ src -o filelist.txt`
    - `-a`命令 :  存储时的文件以指定路径为相对目录进行存储
    - `-l n`命令 : 将**Preprorocessed-Library**选项添加到文件列表中，即:在第一行中加入-n选项(`-n选项：此选项用于指定中间数据文件的目录（预处理结果文件，或简称为预处理文件）。 当ccfx在没有选项-n的情况下运行时，它将为每个输入源文件生成预处理文件（.ccfxprep），并将预处理文件放在相应源文件的同一目录中。 选项-n的参数应该是源文件的目录或其父目录。 否则，该选项将被忽略。`)，在之后的操作中，-n选项将作为某个默认参数加入
    - 克隆检测本身将在没有这些选项的情况下完成（`-a`和`-l n`）。但是，随后使用GemX显示克隆数据文件时会有所需求，并且为了防止预处理文件存在于目标源文件的同一目录中，建议使用这些选项。
2. 当**文件列表准备就绪时**，使用执行模式的选项`-i d`，如下面的命令行，以便**从文件列表中列出的源文件中检测代码克隆**：
    - `ccfx d java -i filelist.txt`
    - PS : 在命令行中指定多个文件列表时，ccfx将会将其当做一个文件列表进行分析，如：
        - `ccfx d java -i filelist1.txt -i filelist2.txt`

#### Part 5. 文件组
文件组用于将文件分成组，并且检测**组与组之间的文件克隆**。执行模式`d`中有两个选项与文件组相关
- 要将源文件分成组，请使用选项`-is`
- 若仅组间检测，而不检测组内的文件克隆情况，请使用选项`-w`

下面介绍**用文件组检测不同版本间的代码克隆的情况**的操作过程 : 旧版本的源文件存储在目录`c：\ oldsrc`中，而较新版本的源文件是`c：\ newsrc`。以下命令行将仅检测**版本之间的代码克隆**
- `ccfx d java -dn c:\oldsrc -is -dn c:\newsrc -w f-w-g+`
    - `d` : 执行模式d
    - `Java` : 用java编写的文件
    - `-dn C:\oldsrc` : 从目录中搜索源文件
    - `-is` : 组分隔符
    - `-dn C:\newsrc` : 同上
    - `w-f-g +` : 这个代表三个操作:
        - "不检测文件中的代码克隆”
        - “不检测同一文件组中文件之间的代码克隆”
        - “检测来自不同文件组的文件之间的代码克隆”。

通过将两个版本与代码克隆进行比较，您可以从相似性的角度分析它们，而不是差异。